<!doctype html>
<html lang="chinese (simplified)">
<head>
  <meta charset="utf-8">
  <!-- Site Meta Data -->
  <title># 13、Pelican内部构件[¶](https://www.osgeo.cn/pelican/internals.html#pelican-internals)</title>
  <meta name="description" content="">
  <meta name="author" content="the_toast">

  <!-- Style Meta Data -->
  <link rel="stylesheet" href="/theme/css/notebook.css" type="text/css" />
  <link rel="shortcut icon" href="/20230502-myphoto.jpg">

  <!-- Feed Meta Data -->
  <link href="/" type="application/atom+xml" rel="alternate" title="the_toast ATOM Feed" />

  <!-- Twitter Feed -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="">
  <meta name="twitter:image" content="/20230502-myphoto.jpg">

<meta name="twitter:creator" content="">
<meta name="twitter:url" content="/13-pelicannei-bu-gou-jian-phttpswwwosgeocnpelicaninternalshtmlpelican-internals.html">
<meta name="twitter:title" content="the_toast ~ # 13、Pelican内部构件[¶](https://www.osgeo.cn/pelican/internals.html#pelican-internals)">
<meta name="twitter:description" content="<p>Date: 2023-10-31
本节描述Pelican如何在内部工作。正如您将看到的，它非常简单，但是一点文档并不有害。:)</p>
<p>你也可以在 <a href="https://www.osgeo.cn/pelican/report.html">Pelican的一些历史</a> 原作者写的一份报告的节选，其中包 …</p>">

<!-- Facebook Meta Data -->
<meta property="og:title" content="the_toast ~ # 13、Pelican内部构件[¶](https://www.osgeo.cn/pelican/internals.html#pelican-internals)" />
<meta property="og:description" content="<p>Date: 2023-10-31
本节描述Pelican如何在内部工作。正如您将看到的，它非常简单，但是一点文档并不有害。:)</p>
<p>你也可以在 <a href="https://www.osgeo.cn/pelican/report.html">Pelican的一些历史</a> 原作者写的一份报告的节选，其中包 …</p>" />
<meta property="og:image" content="20230502-myphoto.jpg" />
</head>

<body>
  <!-- Sidebar -->
  <aside>
    <p><a href=""><img id="avatar" src="/theme/images/20230502-myphoto.jpg"></a></p>
    <h1>the_toast</h1>
    <p></p>
    <hr>
    <h2>Social</h2>
    <ul class="social">
      <li style="list-style-image : url(/theme/images/icons/github.png);"><a href="#">GitHub</a></li>
      <li style="list-style-image : url(/theme/images/icons/facebook.png);"><a href="#">facebook</a></li>
      <li style="list-style-image : url(/theme/images/icons/github2.png);"><a href="#">GitHub2</a></li>
      <li style="list-style-image : url(/theme/images/icons/phone.png);"><a href="13304036141">phone</a></li>
      <li style="list-style-image : url(/theme/images/icons/rss.png);"><a href="/" rel="alternate"><i class="icon-bookmark icon-large"></i>Atom feed</a></li>
    </ul>
    <h2>Categories</h2>
    <ul class="navbar">
      <li class="active"><a href="/category/misc.html">misc</a></li>
      <li><a href="/category/pelicanjiao-cheng.html">pelican教程</a></li>
      <li><a href="/category/review.html">Review</a></li>
      <li><a href="/category/shou-ye.html">首页</a></li>
    </ul> 
  </aside>


  <!--    外部容器-->
<div class="top-bar-wrapper">
  <!--     内部容器-->
        <div class="top-bar clearfix">
  <!--          设置父元素-->
          <div class="top-nav">
  <!--            鼠标移入出现下拉框元素-->
                <h2>目录</h2>
                <ul class="nav">
                  <li><a href="/category/shou-ye.html">首页</a></li>
                  <li><a href="/category/review.html">Review</a></li>
                  <li><a href="/category/pelicanjiao-cheng.html">pelican教程</a></li>
                  <li class="active"><a href="/category/misc.html">misc</a></li>
                </ul>

              </div>
          </div>
        </div>
      </div>


  <!-- Content -->
  <article>
<section id="content">
    <article>
        <header class="post_list">
            <h2 class="post_title"><a href="/13-pelicannei-bu-gou-jian-phttpswwwosgeocnpelicaninternalshtmlpelican-internals.html" rel="bookmark" title="Permalink to # 13、Pelican内部构件[¶](https://www.osgeo.cn/pelican/internals.html#pelican-internals)"># 13、Pelican内部构件[¶](https://www.osgeo.cn/pelican/internals.html#pelican-internals)</a></h2>
            <span>Par </span>
            <a href="/author/the_toast.html">@the_toast</a>
            <span> dans </span>
            <span class="post_category"><a href="/category/misc.html" rel="bookmark" title="Permalink to misc">[ misc ]</a></span>
            <span> le </span>
            <span class="post_date">2010-12-03 星期五 10:20</span>
            <div><span>Tags : </span>
            </div>

            <div class="entry-social">
                <span class="twitter"><a target="_blank" rel="nofollow" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=400,width=700');return false;" title="Twitter" href="https://twitter.com/share?url=/13-pelicannei-bu-gou-jian-phttpswwwosgeocnpelicaninternalshtmlpelican-internals.html&text=# 13、Pelican内部构件[¶](https://www.osgeo.cn/pelican/internals.html#pelican-internals)&via=">Twitter</a></span>

                <span class="gplus"><a target="_blank" title="Google +" href="https://plus.google.com/share?url=/13-pelicannei-bu-gou-jian-phttpswwwosgeocnpelicaninternalshtmlpelican-internals.html&hl=fr" rel="nofollow" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=450,width=650');return false;">Google+</a></span>

                <span class="facebook"><a target="_blank" title="Facebook" rel="nofollow" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=500,width=700');return false;" href="https://www.facebook.com/sharer.php?u=/13-pelicannei-bu-gou-jian-phttpswwwosgeocnpelicaninternalshtmlpelican-internals.html&t=# 13、Pelican内部构件[¶](https://www.osgeo.cn/pelican/internals.html#pelican-internals)">Facebook</a></span>

                <a  target="_blank" title="Linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=</13-pelicannei-bu-gou-jian-phttpswwwosgeocnpelicaninternalshtmlpelican-internals.html&title=# 13、Pelican内部构件[¶](https://www.osgeo.cn/pelican/internals.html#pelican-internals)" rel="nofollow" onclick="javascript:window.open(this.href, '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=450,width=650');return false;">Linkedin</a>

                <span class="mail"><a href="mailto:?subject=# 13、Pelican内部构件[¶](https://www.osgeo.cn/pelican/internals.html#pelican-internals)&amp;body=Viens découvrir un article à propos de [# 13、Pelican内部构件[¶](https://www.osgeo.cn/pelican/internals.html#pelican-internals)] sur le site de the_toast. /13-pelicannei-bu-gou-jian-phttpswwwosgeocnpelicaninternalshtmlpelican-internals.html" title="Share by Email" target="_blank">Mail</a></span>
            </div>
        </header>
        <div class="entry-content">
            <p>Date: 2023-10-31
本节描述Pelican如何在内部工作。正如您将看到的，它非常简单，但是一点文档并不有害。:)</p>
<p>你也可以在 <a href="https://www.osgeo.cn/pelican/report.html">Pelican的一些历史</a> 原作者写的一份报告的节选，其中包含一些软件设计信息。</p>
<h2>总体结构<a href="https://www.osgeo.cn/pelican/internals.html#overall-structure">¶</a></h2>
<p>Pelican所做的是获取一个文件列表并将它们处理成某种输出。通常，输入文件是RestructedText和Markdown文件，输出是blog，但是输入和输出都可以是您想要的任何内容。</p>
<p>逻辑分为不同的类和概念：</p>
<ul>
<li><strong>作家</strong> 负责编写文件：.html文件、RSS提要等。由于这些操作是常用的，所以对象只创建一次，然后传递给生成器。</li>
<li><strong>读者</strong> 用于读取各种格式（目前为HTML、Markdown和RestructedText，但系统是可扩展的）。给定一个文件，它们返回元数据（作者、标记、类别等）和内容（HTML格式）。</li>
<li><strong>生成器</strong> 生成不同的输出。例如，Pelican <code>ArticlesGenerator</code> 和 <code>PageGenerator</code> . 给定一个配置，他们可以做任何他们想做的事。大多数时候，它是从输入生成文件的。</li>
<li>Pelican也使用模板，所以很容易编写自己的主题。语法是 <a href="https://palletsprojects.com/p/jinja/">Jinja2</a> 而且很容易学习，所以不要犹豫，跳进去，建立你自己的主题。</li>
</ul>
<h2>如何实现一个新的阅读器？<a href="https://www.osgeo.cn/pelican/internals.html#how-to-implement-a-new-reader">¶</a></h2>
<p>你想给Pelican添加一种很棒的标记语言吗？好吧，你唯一要做的就是用 <code>read</code> 方法返回HTML内容和一些元数据。</p>
<p>看看降价阅读器：</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">pelican.readers</span> <span class="kn">import</span> <span class="n">BaseReader</span>
<span class="kn">from</span> <span class="nn">pelican.utils</span> <span class="kn">import</span> <span class="n">pelican_open</span>
<span class="kn">from</span> <span class="nn">markdown</span> <span class="kn">import</span> <span class="n">Markdown</span>

<span class="k">class</span> <span class="nc">MarkdownReader</span><span class="p">(</span><span class="n">BaseReader</span><span class="p">):</span>
    <span class="n">enabled</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse content and metadata of markdown files&quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">pelican_open</span><span class="p">(</span><span class="n">source_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">text</span><span class="p">:</span>
            <span class="n">md_extensions</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;markdown.extensions.meta&#39;</span><span class="p">:</span> <span class="p">{},</span>
                             <span class="s1">&#39;markdown.extensions.codehilite&#39;</span><span class="p">:</span> <span class="p">{}}</span>
            <span class="n">md</span> <span class="o">=</span> <span class="n">Markdown</span><span class="p">(</span><span class="n">extensions</span><span class="o">=</span><span class="n">md_extensions</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                          <span class="n">extension_configs</span><span class="o">=</span><span class="n">md_extensions</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">md</span><span class="o">.</span><span class="n">Meta</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_metadata</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">metadata</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">meta</span>
        <span class="k">return</span> <span class="n">content</span><span class="p">,</span> <span class="n">metadata</span>
</code></pre></div>

<p>很简单，不是吗？</p>
<p>如果您的新阅读器需要额外的Python依赖项，那么您应该将它们 <code>import</code> a中的语句 <code>try...except</code> 阻止。然后在reader的类中，设置 <code>enabled</code> 类属性来标记导入成功或失败。这使得用户可以继续使用他们喜欢的标记方法，而无需为他们不使用的格式安装模块。</p>
<h2>如何实现一个新的生成器？<a href="https://www.osgeo.cn/pelican/internals.html#how-to-implement-a-new-generator">¶</a></h2>
<p>生成器有两种重要的方法。您不必同时创建这两个；只调用现有的。</p>
<ul>
<li><code>generate_context</code> ，这是第一个，对于所有的生成器。做你该做的事情，如果需要的话更新全局上下文。此上下文在所有生成器之间共享，并将传递给模板。例如 <code>PageGenerator</code> <code>generate_context</code> 方法查找所有页，将它们转换为对象，并用它们填充上下文。小心 <em>not</em> 在这个阶段使用此上下文输出任何内容，因为它可能会因其他生成器的影响而更改。</li>
<li><code>generate_output</code> 然后调用。猜猜它是做什么用的？哦，产生输出。：）在这里，您可能需要查看上下文并调用 <code>writer</code> 作为此函数的第一个参数传递的。在 <code>PageGenerator</code> 例如，此方法将查看全局上下文中记录的所有页面，并在磁盘上输出一个文件（使用writer方法 <code>write_file</code> )对于遇到的每个页面。</li>
</ul>
<p><a href="https://www.osgeo.cn/pelican/contribute.html"> Previous</a><a href="https://www.osgeo.cn/pelican/report.html">Next </a></p>
        </div>
    </article>
</section>
  </article>

  <!-- Footer -->
  <footer>
    <address id="about" class="vcard body">
      Blog powered by <a href="http://getpelican.com/">Pelican</a>, 
      which takes great advantage of <a href="http://python.org">Python</a>.
      Theme <a href="https://github.com/quack1/notebook/">Notebook</a> by <a href="https://twitter.com/_Quack1">@Quack1</a>.
    </address>
  </footer>


</body>
</html>